<div header class="view-container__header"></div>

<div class="view-container__content">

    <div class="insights__textsection">
        Here are some useful insights around your expenses.
    </div>

    <!-- Insight fetch form -->
    <div class="insights__controls">

        <form name="insightForm" class="insights__controls__form" ng-submit="submitLoadInsight()" novalidate>

            <!-- Flash messages. -->
            <div flash-messages flash="flash" identifier-id="{{alertIdentifierId}}"></div>

            <!-- Select prev month -->
            <button type="button" class="insights__controls__form__arrow" ng-disabled="isLoading || ! canLoadPrevMonth()" ng-click="prevMonth()"> <</button>

            <div class="insights__controls__form__month" ng-class="{'has-error': insightForm.spentDate.$invalid && insightForm.$submitted}">

                <!--Hidden input of the insight chosen date-->
                <input type="hidden" name="spentDate" ng-model="insightData.spentDate" required valid-date />

                <!--insight date picker-->
                <div class="insight__form__date__input">
                    <button type="button"
                            class="insight__form__date__input__btn"
                            ng-click="openDatePicker($event)"
                            ng-model="insightData.spentDate"
                            datepicker-popup
                            is-open="datePickerOpened"
                            ng-change="onChange()"
                            ng-disabled="isLoading"
                            min-date="datePickerMinDate"
                            max-date="datePickerMaxDate"
                            datepicker-mode="'month'" min-mode="month"
                            show-button-bar="false"
                            datepicker-options="{minMode: 'month',datepickerMode: 'month'}">{{isLoading ? 'Loading expenses from' : ''}} {{insightData.spentDate | friendlyMonthDate}}
                    </button>
                </div>

                <!--Error messages-->
                <div class="form-group-input__message" ng-class="{'has-error': insightForm.spentDate.$invalid && insightForm.$submitted}" ng-messages="insightForm.$error" ng-if="insightForm.$submitted">
                    <div ng-message="required">Please add a date.</div>
                    <div ng-message="validDate">Date should be in the past.</div>
                </div>
            </div>

            <!-- Select next month -->
            <button type="button" class="insights__controls__form__arrow" ng-disabled="isLoading || ! canLoadNextMonth()" ng-click="nextMonth()"> ></button>

        </form>

    </div>

    <div class="insights__summary">
        <div class="insights__summary__thumbnail">
            <span class="insights__summary__thumbnail__number">{{insight.model.totalAmountSpent}}</span>
            <span class="insights__summary__thumbnail__label">TOTAL</span>
        </div>
        <div class="insights__summary__thumbnail">
            <span class="insights__summary__thumbnail__number">{{insight.model.numberOfTransactions}}</span>
            <span class="insights__summary__thumbnail__label">transactions</span>
        </div>
        <div class="insights__summary__thumbnail">
            <span class="insights__summary__thumbnail__number">+5%</span>
            <span class="insights__summary__thumbnail__label">from previous month</span>
        </div>
    </div>

    <div class="insights__chart__bar">
        <canvas id="bar"
                class="chart chart-bar"
                data="insightLineData"
                series="insightLineSeries"
                legend="true"
                labels="insight.model.insightLabels">
        </canvas>
    </div>

    <div class="insights__table">
        <table>
            <thead class="insights__table__header">
            <tr>
                <td>TOTAL</td>
                <td class="insights__table__amount">{{insight.model.totalAmountSpent}}</td>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="totalPerCategory in insight.model.totalPerCategoryInsightDTOs">
                <td class="insights__table__category">
                    <span class="insights__table__category__color" ng-style="{'background':totalPerCategory.categoryDTO.color}">C</span>
                    {{totalPerCategory.categoryDTO.name}}
                </td>
                <td class="insights__table__amount">{{totalPerCategory.totalAmount}}</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="insights__chart__doughnut">
        <canvas class="chart chart-doughnut"
                data="insight.model.insightData"
                labels="insight.model.insightLabels"
                colours="insight.model.insightColors">
        </canvas>
    </div>

    <div>The chart below will go on the second tab, on the compare mode.</div>
    <canvas id="line"
            class="chart chart-line"
            data="insightLineData"
            labels="insight.model.insightLabels"
            series="insightLineSeries"
            legend="true"></canvas>
</div>

<div footer class="view-container__footer"></div>