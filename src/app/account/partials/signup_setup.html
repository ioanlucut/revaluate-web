<div class="sign-up__setup">

    <div class="sign-up__setup__box">

        <h2 class="sign-up__setup__title">Awesome! Select your currency and the categories and you're done!</h2>

        <!-- Set up form -->
        <form name="setUpForm" ng-submit="setUp()" novalidate>

            <div class="sign-up__setup__section">
                Please choose your currency:
                <div class="sign-up__setup__section--currency" ng-class="{'has-error': setUpForm.$submitted && (setUpForm.currency.$invalid || badPostSubmitResponse)}">

                    <ui-select name="currency" class="sign-up__setup__section--currency__input" required ng-model="currency.selected" theme="selectize" append-to-body="true">
                        <ui-select-match placeholder="Start typing your currency...">{{$select.selected.currencyCode}}</ui-select-match>
                        <ui-select-choices repeat="currencyEntry in currencies | orderObjectBy : 'currencyCode' : false | filter:{$:$select.search} track by currencyEntry.numericCode">
                            <span ng-bind-html="currencyEntry.currencyCode | highlight: $select.search"></span>
                            <span ng-bind-html="currencyEntry.displayName | highlight: $select.search"></span>
                        </ui-select-choices>
                    </ui-select>

                    <!-- Error messages -->
                    <div class="form-group-input__message form-group-input__message--currency" ng-class="{'has-error': setUpForm.category.$invalid && setUpForm.$submitted}" ng-messages="setUpForm.$error" ng-if="setUpForm.$submitted">
                        <div ng-message="required">Please add a currency.</div>
                    </div>
                </div>
            </div>

            <div class="sign-up__setup__tip">
                Here are a few categories we will add for you. Feel free to <strong>de-select</strong> or
                <strong>add your own</strong> at the bottom. You can change them later as well.
            </div>

            <div class="sign-up__box__categories">
                <div class="sign-up__box__categories__category" ng-repeat="category in categories track by category.name">
                    <div class="category-name" ng-style="{'background':category.color.color}" ng-class="{ 'category-name--unselected': !category.selected }" ng-click="toggleCategorySelection($index)">
                        <span class="icon-checkmark-light"></span>
                        {{category.name}}
                    </div>
                </div>
            </div>

            <div class="sign-up__box__categories">

                <!--Toggle form-->
                <button ng-if="! showCategoryOnTheFlyInput" class="sign-up__box__categories__addbtn" ng-click="toggleContent()">+ Add another</button>

                <!--Add category on the fly form-->
                <ng-form class="sign-up__box__categories__category__form"
                         name="categoryOnTheFlyForm"
                         submit-on="add-category-on-the-fly-event"
                         ng-submit="onSubmitted($event)"
                         ng-if="showCategoryOnTheFlyInput">

                    <div ng-class="{'has-error': categoryOnTheFlyForm.$submitted && categoryOnTheFlyForm.name.$invalid}">

                        <!-- Error messages -->
                        <div class="form-group-input__message" ng-class="{'has-error': categoryOnTheFlyForm.name.$invalid}" ng-messages="categoryOnTheFlyForm.name.$error" ng-if="categoryOnTheFlyForm.$submitted">
                            <div ng-message="required">Name is mandatory.</div>
                            <div ng-message="validCategoryName">Name is not valid.</div>
                        </div>

                        <!--The on the fly input category-->
                        <input class="sign-up__box__categories__addinput" type="text" name="name"
                               maxlength="15"
                               ng-model="$parent.categoryOnTheFly"
                               ng-enter="triggerSubmit()"
                               ng-blur="cancelAddCategoryOnTheFly()"
                               auto-focus required valid-category-name />

                    </div>
                </ng-form>
            </div>

            <!-- Flash messages. -->
            <div flash-messages flash="flash" identifier-id="{{alertIdentifierId}}"></div>

            <!-- Button -->
            <button class="sign-up__setup__btn" ng-disabled="! isEnoughSelectedCategories()" type="submit">{{isSaving ? 'Saving..' : 'Done! Let\'s start!'}}</button>
        </form>

    </div>

</div>