<!--Display expense-->
<div class="expenses__list__entry__display" ng-if="! showContent" ng-class="expense.marked ? 'expense__bulk--marked' : ''" ng-click="toggleMark();$event.stopPropagation();">

    <div class="expenses__list__entry__select icon-checkmark" ng-if="expense.marked"></div>

    <div class="expenses__list__entry__price">
        {{expense.model.value | currency:""}}
        <span class="expenses__list__entry__currency">{{user.model.currency.currencyCode}}</span>
    </div>

    <!--Expense category-->
    <div class="expenses__list__entry__category" ng-style="{'background':expense.model.category.color.color}" ng-bind-html="expense.model.category.name"></div>

    <!--Expense description-->
    <div class="expenses__list__entry__details" ng-bind-html="expense.model.description | highlightSearch:searchByText"></div>

    <!--Expense date-->
    <div class="expenses__list__entry__date">{{expense.model.spentDate | friendlyDate}}</div>

    <button class="expenses__list__entry__editbtn icon-pen" type="button" ng-click="toggleContent();"></button>
</div>

<!-- Display expense in edit mode -->
<div class="expenses__form" ng-if="showContent">

    <form name="expenseForm" ng-submit="updateExpense(expenseForm, shownExpense, category)" novalidate focus-first-error>

        <!-- Form groups -->
        <div class="expense__form__price" ng-class="{'has-error': expenseForm.$submitted && (expenseForm.value.$invalid || badPostSubmitResponse)}">
            <input class="expense__form__price__input" type="text" name="value" placeholder="The value" ng-model="shownExpense.model.value" format-price format="number" caret-price-position required valid-price />
            <span class="expense__form__price__currency">{{user.model.currency.currencyCode}}</span>

            <!-- Error messages -->
            <div class="form-group-input__message" ng-class="{'has-error': expenseForm.value.$invalid && expenseForm.$submitted}" ng-messages="expenseForm.$error" ng-if="expenseForm.$submitted">
                <div ng-message="required">Please add a price.</div>
                <div ng-message="validPrice">Price is invalid</div>
            </div>
        </div>

        <!-- Form group -->
        <div class="expense__form__category" ng-class="{'has-error': expenseForm.$submitted && (expenseForm.$error['autocomplete-required'] || expenseForm.category.$invalid || badPostSubmitResponse)}">

            <div angucomplete-alt
                 selected-object="category"
                 local-data="categories"
                 search-fields="model.name"
                 title-field="model.name"
                 field-required="true"
                 placeholder="Add category"
                 maxlength="50"
                 pause="1"
                 minlength="0"
                 initial-value="{{shownExpense.model.category.name}}"
                 input-class="expense__form__category__input"
                 match-class="highlight"
                 template-url="app/expenses/partials/expense.category.template.html">
            </div>

            <!-- Error messages -->
            <div class="form-group-input__message" ng-class="{'has-error': expenseForm.$invalid && expenseForm.$submitted}" ng-messages="expenseForm.$error" ng-if="expenseForm.$submitted">
                <div ng-message="autocomplete-required">Category is missing or is invalid.</div>
            </div>

            <div class="form-group-input__message" ng-if="expenseForm.category.$invalid && expenseForm.$submitted">Please add a category.</div>
        </div>

        <!-- Description input -->
        <div class="expense__form__details" ng-class="{'has-error': expenseForm.$submitted && (expenseForm.description.$invalid || badPostSubmitResponse)}">
            <input class="expense__form__details__input" type="text" name="description" ng-maxlength="30" maxlength="30" placeholder="Add details (optional)" ng-model="shownExpense.model.description" escape-html />

            <!-- Error messages -->
            <div class="form-group-input__message" ng-class="{'has-error': expenseForm.description.$invalid && expenseForm.$submitted}" ng-messages="expenseForm.$error" ng-if="expenseForm.$submitted">
                <div ng-message="maxlength">Hmm. Too long.</div>
            </div>
        </div>

        <!-- Date input -->
        <div class="expense__form__date" ng-class="{'has-error': expenseForm.spentDate.$invalid && expenseForm.$submitted}">

            <!--Hidden input of the expense chosen date-->
            <input type="hidden" name="spentDate" ng-model="shownExpense.model.spentDate" required valid-date />

            <!--Expense date picker-->
            <div class="expense__form__date__input">
                <button ng-click="openDatePicker($event)" type="button"
                        datepicker-popup is-open="datePickerStatus.opened"
                        min-date="minDate"
                        max-date="maxDate"
                        ng-model="shownExpense.model.spentDate"
                        datepicker-options="{startingDay:1,showWeeks:false}">
                    {{shownExpense.model.spentDate | friendlyDate}}
                </button>
            </div>

            <!--Error messages-->
            <div class="form-group-input__message" ng-class="{'has-error': expenseForm.spentDate.$invalid && expenseForm.$submitted}" ng-messages="expenseForm.$error" ng-if="expenseForm.$submitted">
                <div ng-message="required">Please make that you add a date.</div>
                <div ng-message="validDate">Date should be in the past.</div>
            </div>
        </div>

        <!-- Button container -->
        <div class="expense__form__submit">
            <span ng-if="isUpdating">
                <span>Saving the expense...</span>
            </span>
            <span ng-if="! isUpdating">
                <span class="expense__edit__form__cancelbtn">
                    <button type="button" ng-click="cancel();">Discard</button>
                    <span>changes.</span>
                </span>
                <span class="expense__edit__form__savebtn">
                    <span>Enter to</span>
                    <button type="submit">save</button>
                    <span>the changes.</span>
                </span>
            </span>
        </div>
    </form>


</div>